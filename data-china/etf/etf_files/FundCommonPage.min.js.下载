var fundCommonTools = {}; fundCommonTools = { addFavorPage: function (url, title) { url = url || window.location.href; title = title || window.document.title; try { window.external.addFavorite(url, title) } catch (e) { try { window.sidebar.addPanel(title, url, "") } catch (e) { alert("加入收藏失败，请使用Ctrl+D进行添加") } } }, setHome: function (obj) { try { obj.style.behavior = "url(#default#homepage)"; obj.setHomePage(window.location) } catch (e) { if (window.netscape) { try { netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect") } catch (e) { alert("此操作被浏览器拒绝！请在浏览器地址栏输入“about:config”并回车然后将[signed.applets.codebase_principal_support]设置为'true'") } var prefs = Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch); prefs.setCharPref("browser.startup.homepage", window.location) } } } }; (function ($) { var JsLoader = function (sUrl, fCallback) { var _script = document.createElement("script"); _script.setAttribute("type", "text/javascript"); _script.setAttribute("src", sUrl); _script.setAttribute("charset", "utf-8"); document.getElementsByTagName("head")[0].appendChild(_script); if (_script.addEventListener) { _script.onload = function () { _script.parentNode.removeChild(_script); if (fCallback) { fCallback() } } } else { if (_script.readyState) { _script.onreadystatechange = function () { if (_script.readyState == "loaded" || _script.readyState == "complete") { _script.onreadystatechange = null; _script.parentNode.removeChild(_script); if (fCallback) { fCallback() } } } } else { _script.parentNode.removeChild(_script) } } }; var login = { loadURL: "https://sso.1234567.com.cn/FundTradeLoginState.aspx", tradeUrl: "https://api.fund.eastmoney.com/Trade/Logout?callback=?", tradeGetUrl: "https://api.fund.eastmoney.com/Trade/GetTradeUserInfo?callback=?", loadData: function (callback) { var _this = this; var ltoken = _this.getCookie("LToken"); if (typeof (customer) != "undefined" && customer && "" !== customer.CustomerNo && "" !== customer.CustomerName) { callback() } else { var cookieName = "FundWebTradeUserInfo"; var info = _this.getCookie(cookieName); if (!!info && !!window.atob) { window.customer = JSON.parse(_this.base64Decode(info)) } if (typeof (customer) != "undefined" && customer && "" !== customer.CustomerNo && "" !== customer.CustomerName) { callback() } else { JsLoader(_this.loadURL + "?lt=" + ltoken + "&v=" + Math.random(), function () { if (typeof (customer) != "undefined" && customer && "" !== customer.CustomerNo && "" !== customer.CustomerName) { callback() } else { $.getJSON(_this.tradeGetUrl, function (data) { window.customer = data; callback() }) } }) } } }, initLoginHtml: function () { var _this = this; if (window.btoa && typeof (customer) != "undefined" && customer && "" !== customer.CustomerNo && "" !== customer.CustomerName) { var cookieName = "FundWebTradeUserInfo"; var domain = ".eastmoney.com"; _this.setCookie(cookieName, _this.base64Encode(JSON.stringify(customer)), domain, 120) } _this.initHeaderInfo() }, initHeaderInfo: function () { var _this = this; setTimeout(function () { if (typeof (customer) != "undefined" && customer && customer.CustomerNo && customer.CustomerNo != "") { var loginhtml = '<a class="noPadding" href="https://trade.1234567.com.cn/MyAssets/Default">' + customer.CustomerName + "</a>"; var _titlestr = "您还不是vip会员，点击图标查看如何成为会员"; if (!!customer.VipLevel && customer.VipLevel != "" && !isNaN(customer.VipLevel) && parseInt(customer.VipLevel) > 0) { _titlestr = "您是V" + customer.VipLevel + "会员，点击查看会员权益" } loginhtml += "<a target='_blank' href='https://vip.1234567.com.cn/Default' title='" + _titlestr + "' class='vipicon viplevel" + customer.VipLevel + "'></a>"; var logoutObj = $("#logoutTTJJ").removeClass("ui-hide").find(".CustomerName"); logoutObj.addClass("pr20"); logoutObj.html(loginhtml); if (customer && customer.LToken && customer.LToken != "") { document.cookie = "LToken=" + customer.LToken + "; domain=.eastmoney.com; path=/" } $("#loginTTJJ").addClass("ui-hide"); $(".js-logout-show").addClass("ui-hide"); $("#logout").on("click", function () { _this.logout() }) } else { $("#logout").off("click") } }, 5) }, isLogin: function () { var _this = this; _this.loadData(function () { return (typeof (customer) != "undefined" && customer && "" !== customer.CustomerNo && "" !== customer.CustomerName) }) }, logout: function () { var _this = this; var cookieName = "FundWebTradeUserInfo"; _this.delCookie(cookieName); _this.delCookie("LToken"); JsLoader(this.loadURL + "?t=logout&v=" + +(new Date()).getTime(), function () { $("#logoutTTJJ").addClass("ui-hide").find(".CustomerName").html(""); $("#loginTTJJ").removeClass("ui-hide"); $(".js-logout-show").removeClass("ui-hide") }); $.getJSON(this.tradeUrl, function (data) {  }) }, init: function () { var _this = this; _this.loadData(function () { _this.initLoginHtml() }) }, setCookie: function (name, value, domain, minutes) { var $this = this; var exp = new Date(); exp.setTime(exp.getTime() + minutes * 60 * 1000); document.cookie = name + "=" + escape(value) + ";path=/;expires=" + exp.toGMTString() + (domain ? ";domain=" + domain : "") }, delCookie: function (name) { var $this = this; var exp = new Date(); exp.setTime(exp.getTime() - 1); var cval = this.getCookie(name); if (cval != null) { document.cookie = name + "=" + cval + ";path=/;expires=" + exp.toGMTString() } }, getCookie: function (name) { var $this = this; var arrStr = document.cookie.split("; ");  var temp; if (!name) { return "Allcookies: " + arrStr } else { for (var i = 0; i < arrStr.length; i++) { temp = arrStr[i].split("="); if (temp[0] === name) { return unescape(temp[1]) } } } return "" }, base64Encode: function (str) { var encode = encodeURI(str); var base64 = btoa(encode); return base64 }, base64Decode: function (base64) { var decode = atob(base64); var str = decodeURI(decode); return str } }; login.init() })(window.jQuery); (function ($) { $(document).ready(function () { $("#favorPage").unbind().on("click", function (e) { fundCommonTools.addFavorPage() }) }) })(window.jQuery); (function ($) { $(document).ready(function () { var $fund_common_header = $("#fund_common_header"); $fund_common_header.find(".dropdown ").hover(function () { $(this).addClass("open") }, function () { $(this).removeClass("open") }); $("#setHome").unbind().click(function (e) { fundCommonTools.setHome(this) }); $("#addFavor").unbind().click(function (e) { fundCommonTools.addFavorPage("http://www.1234567.com.cn", "天天基金网") }) }) })(window.jQuery);