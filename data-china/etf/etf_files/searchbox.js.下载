var j = jQuery.noConflict(); var initEvent = function ($, mod) { mod.api = "//fundsuggest.eastmoney.com/FundSearch/api/FundSearchAPI.ashx"; mod.select = { "fund": { inputContent: "请输入基金代码、名称或简拼", innerHtml: $('<div class="tooltip-inner-F">'), innerHtml2: '<div class="leftpanel loading seaWidthL" data-searchBox="panel"></div><div class="rightpanel loading seaWidthS"></div>', alphabet: true }, "fund-manager": { inputContent: "例：输入“王宁”或“wn”", innerHtml: $('<div class="tooltip-inner-FM">'), innerHtml2: '<div class="allpanel loading" data-searchBox="panel"></div>', alphabet: false }, "fund-corp": { inputContent: "例：输入“华夏”或“hx”", innerHtml: $('<div class="tooltip-inner-FM">'), innerHtml2: '<div class="allpanel loading" data-searchBox="panel"></div>', alphabet: false } }; mod.keyCode = { LEFT: 37, UP: 38, RIGHT: 39, DOWN: 40, table: 9, ESCAPE: 27, ENTER: 13, SHIFT: 16, CAPS: 20 }; mod.hrefName = { "基金": "http://fund.eastmoney.com/", "A股": "//quote.eastmoney.com/unify/r/", "B股": "//quote.eastmoney.com/unify/r/", "港股": "//quote.eastmoney.com/unify/r/", "美股": "//quote.eastmoney.com/unify/r/", "债券1": "//quote.eastmoney.com/unify/r/", "债券2": "//quote.eastmoney.com/unify/r/", "期货": "//quote.eastmoney.com/unify/r/", "指数": "//quote.eastmoney.com/unify/r/", "FM": "http://fund.eastmoney.com/manager/", "FC": "http://fund.eastmoney.com/company/", "沪市": "//quote.eastmoney.com/unify/r/", "深市": "//quote.eastmoney.com/unify/r/", "期指": "//quote.eastmoney.com/unify/r/", "期权": "//quote.eastmoney.com/unify/r/", "香港基金": "http://overseas.1234567.com.cn/", "高端理财": "http://fund.eastmoney.com/Gaoduan/", "": "//quote.eastmoney.com/unify/r/" }; mod.isBuy = ["", "正常开放", "认购时期", "停止赎回", "停止申购", "封闭期", "停止交易", "基金终止", "权益登记", "红利发放", "发行失败"]; mod.nav = ["A", "B", "C", "D", "F", "G", "H", "J", "M", "N", "P", "Q", "R", "S", "T", "W", "X", "Y", "Z"]; mod.tooltip = function (name) { var $nav = $('<div class="tooltip-nav clearfix">'), dismiss = '<div class="search-right search-close"><a href="javascript:void(0)" target="_self" data-searchBox="dismiss">[关闭]</a></div>', body = '<div class="tooltip-body clearfix">' + this.select[name].innerHtml2 + "</div>", $inner = this.select[name].innerHtml, bol = this.select[name].alphabet, that = this; $nav.html(this.createUl(bol) + dismiss); $inner.html(body).prepend($nav); return $inner }; mod.createUl = function (bol) { var ul = '<ul class="search-left">', html = '<li class="active text-ie6"><a href="javascript:void(0)" target="_self"><b>最近搜索</b></a></li>'; if (bol) { for (var i = 0; i < this.nav.length; i++) { html += '<li data-alphabet="' + this.nav[i] + '"><a href="javascript:void(0)" target="_self">' + this.nav[i] + "</a></li>" } } ul += html + "</ul>"; return ul }; mod.JsLoader = function (sUrl, data, fCallback, bol) { $.ajax({ url: sUrl, dataType: "jsonp", data: data, scriptCharset: "utf-8", success: function (result) { if (fCallback) { fCallback(result) } } }) }; mod.Ie8_Ie6 = function () { var _script = document.createElement("script"); if (_script.addEventListener) { return true } else { if (_script.readyState) { return false } else { return null } } }; mod.isPhone = function () { var isWindows = (/Windows/gi).test(navigator.appVersion), isIOS = (/iphone|ipad/gi).test(navigator.appVersion), isAndroid = (/android/gi).test(navigator.appVersion); if (isAndroid) { return "android" } else { if (isIOS) { return "ios" } else { if (isWindows) { return "windows" } } } }; return mod }(j, window.initEvent || {}); (function ($) { $.fn.searchbar_select = function () { this.each(function () { var $this = $(this), $lis = $this.find(".select-option li"), $head = $this.find(".select-head"), $option = $this.find(".select-option"), $content = $(this).find(".headContent"), text = $this.find(".select-option li.active").html(), opening = false, random = Math.random(); $content.html(text); $head.on("click.select.focus", function (e) { e.preventDefault(); var index = $lis.index($this.find(".select-option li.active")); if (!opening) { $option.addClass("open"); opening = true; $(document).on("click.select.blur" + random, function (e) { e.preventDefault(); if ($(e.target)[0].tagName.toLowerCase() === "li") { for (var i = 0; i < $lis.length; i++) { if ($(e.target)[0] === $lis[i]) { if (i === index) { $(document).off("click.select.blur" + random); $(window).off("scroll.select.blur" + random); $option.removeClass("open"); opening = false } else { var initE = $.Event("trigger.select.lily", { relatedTarget: $lis.eq(i) }); $this.trigger(initE); $lis.removeClass("active").eq(i).addClass("active"); $content.html($lis.eq(i).html()); $(document).off("click.select.blur" + random); $(window).off("scroll.select.blur" + random); $option.removeClass("open"); opening = false } break } } } else { if ($(e.target)[0] !== $content[0]) { $(document).off("click.select.blur" + random); $(window).off("scroll.select.blur" + random); $option.removeClass("open"); opening = false } } }); $(window).on("scroll.select.blur" + random, function () { $(document).off("click.select.blur" + random); $(window).off("scroll.select.blur" + random); $option.removeClass("open"); opening = false }) } else { $option.removeClass("open"); opening = false; $(document).off("click.select.blur" + random); $(window).off("scroll.select.blur" + random) } }); $lis.hover(function (e) { e.preventDefault(); $(this).addClass("hover") }, function (e) { e.preventDefault(); $(this).removeClass("hover") }).eq(-1).addClass("noborder") }) }; $.fn.delayCursor = function (obj, that) { var MOUSE_LOCS_TRACKED = 2, mouseLocs = [], $objs = $(this).find(obj), timeoutId = null, DELAY = 300, lastDelayLoc = null; var mousemoveDocument = function (e) { mouseLocs.push({ x: e.pageX, y: e.pageY }); if (mouseLocs.length > MOUSE_LOCS_TRACKED) { mouseLocs.shift() } }; var activationDelay = function () { var lastPoint = mouseLocs[0], nowPoint = mouseLocs[1]; if (!lastPoint || !nowPoint) { return 0 } if (lastDelayLoc && lastDelayLoc.x === nowPoint.x && lastDelayLoc.y === nowPoint.y) { return 0 } if (lastPoint.x > nowPoint.x || lastPoint.y > nowPoint.y) { return 0 } lastDelayLoc = nowPoint; return DELAY }; var activate = function (row) { $(document).off("mousemove.moveApi"); $objs.off("mouseenter.moveApi").off("mouseleave.moveApi"); that.menuEvent_fund($("tbody")).activateSubmenu_fund(row) }; var possiblyActivate = function (row) { var delay = activationDelay(); if (delay) { timeoutId = setTimeout(function () { possiblyActivate(row) }, delay) } else { activate(row) } }; if (!$objs.length) { return } $(document).off("mousemove.moveApi").on("mousemove.moveApi", mousemoveDocument); $objs.each(function () { var $this = $(this); $this.off("mouseenter.moveApi").off("mouseleave.moveApi").on("mouseenter.moveApi", function (e) { if (timeoutId) { clearTimeout(timeoutId) } possiblyActivate(this) }).on("mouseleave.moveApi", function (e) { if (timeoutId) { clearTimeout(timeoutId) } }) }) } })(j); (function ($) { $.fn.menuAim = function (opts) { this.each(function () { init.call(this, opts) }); return this }; function init(opts) { var $menu = $(this), activeRow = null, mouseLocs = [], lastDelayLoc = null, timeoutId = null, options = $.extend({ rowSelector: "[data-submenu]", submenuSelector: "*", submenuDirection: "right", tolerance: 75, enter: $.noop, exit: $.noop, activate: $.noop, deactivate: $.noop, exitMenu: $.noop }, opts); var MOUSE_LOCS_TRACKED = 3, DELAY = 300; var mousemoveDocument = function (e) { mouseLocs.push({ x: e.pageX, y: e.pageY }); if (mouseLocs.length > MOUSE_LOCS_TRACKED) { mouseLocs.shift() } }; var mouseleaveMenu = function () { if (timeoutId) { clearTimeout(timeoutId) } if (options.exitMenu(this)) { if (activeRow) { options.deactivate(activeRow) } activeRow = null } }; var mouseenterRow = function () { if (timeoutId) { clearTimeout(timeoutId) } options.enter(this); possiblyActivate(this) }, mouseleaveRow = function () { options.exit(this) }; var clickRow = function () { activate(this) }; var activate = function (row) { if (row == activeRow) { return } if (activeRow) { options.deactivate(activeRow) } options.activate(row); activeRow = row }; var possiblyActivate = function (row) { var delay = activationDelay(); if (delay) { timeoutId = setTimeout(function () { possiblyActivate(row) }, delay) } else { activate(row) } }; var activationDelay = function () { if (!activeRow || !$(activeRow).is(options.submenuSelector)) { return 0 } var offset = $menu.offset(), upperLeft = { x: offset.left, y: offset.top - options.tolerance }, upperRight = { x: offset.left + $menu.outerWidth(), y: upperLeft.y }, lowerLeft = { x: offset.left, y: offset.top + $menu.outerHeight() + options.tolerance }, lowerRight = { x: offset.left + $menu.outerWidth(), y: lowerLeft.y }, loc = mouseLocs[mouseLocs.length - 1], prevLoc = mouseLocs[0]; if (!loc) { return 0 } if (!prevLoc) { prevLoc = loc } if (prevLoc.x < offset.left || prevLoc.x > lowerRight.x || prevLoc.y < offset.top || prevLoc.y > lowerRight.y) { return 0 } if (lastDelayLoc && loc.x == lastDelayLoc.x && loc.y == lastDelayLoc.y) { return 0 } function slope(a, b) { return (b.y - a.y) / (b.x - a.x) } var decreasingCorner = upperRight, increasingCorner = lowerRight; if (options.submenuDirection == "left") { decreasingCorner = lowerLeft; increasingCorner = upperLeft } else { if (options.submenuDirection == "below") { decreasingCorner = lowerRight; increasingCorner = lowerLeft } else { if (options.submenuDirection == "above") { decreasingCorner = upperLeft; increasingCorner = upperRight } } } var decreasingSlope = slope(loc, decreasingCorner), increasingSlope = slope(loc, increasingCorner), prevDecreasingSlope = slope(prevLoc, decreasingCorner), prevIncreasingSlope = slope(prevLoc, increasingCorner); if (decreasingSlope < prevDecreasingSlope && increasingSlope > prevIncreasingSlope) { lastDelayLoc = loc; return DELAY } lastDelayLoc = null; return 0 }; $menu.mouseleave(mouseleaveMenu).find(options.rowSelector).mouseenter(mouseenterRow).mouseleave(mouseleaveRow).click(clickRow); $(document).mousemove(mousemoveDocument) } })(j);(function (factory) { if (typeof define === "function" && define.amd) { define(["jquery"], factory) } else { if (typeof exports === "object") { factory(require("jquery")) } else { factory(j) } } }(function ($) { var pluses = /\+/g; function encode(s) { return config.raw ? s : encodeURIComponent(s) } function decode(s) { return config.raw ? s : decodeURIComponent(s) } function stringifyCookieValue(value) { return encode(config.json ? JSON.stringify(value) : String(value)) } function parseCookieValue(s) { if (s.indexOf('"') === 0) { s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\") } try { s = decodeURIComponent(s.replace(pluses, " ")); return config.json ? JSON.parse(s) : s } catch (e) { } } function read(s, converter) { var value = config.raw ? s : parseCookieValue(s); return $.isFunction(converter) ? converter(value) : value } var config = $.cookie = function (key, value, options) { if (value !== undefined && !$.isFunction(value)) { options = $.extend({}, config.defaults, options); if (typeof options.expires === "number") { var days = options.expires, t = options.expires = new Date(); t.setTime(+t + days * 86400000) } return (document.cookie = [encode(key), "=", stringifyCookieValue(value), options.expires ? "; expires=" + options.expires.toUTCString() : "", options.path ? "; path=" + options.path : "", options.domain ? "; domain=" + options.domain : "", options.secure ? "; secure" : ""].join("")) } var result = key ? undefined : {}; var cookies = document.cookie ? document.cookie.split("; ") : []; for (var i = 0, l = cookies.length; i < l; i++) { var parts = cookies[i].split("="); var name = decode(parts.shift()); var cookie = parts.join("="); if (key && key === name) { result = read(cookie, value); break } if (!key && (cookie = read(cookie)) !== undefined) { result[name] = cookie } } return result }; config.defaults = {}; $.removeCookie = function (key, options) { if ($.cookie(key) === undefined) { return false } $.cookie(key, "", $.extend({}, options, { expires: -1 })); return !$.cookie(key) } })); (function ($) { var SearchBox = function (ele, options) { this.$target = $(ele); this.options = options; this.$tooltipTarget = $(this.options.target); this.$input = this.$target.find('[data-searchBox="input"]'); this.$submit = this.$target.find('[data-searchBox="submit"]'); this.$select = this.$target.find('[data-searchBox="select"]'); this.$label = this.$target.find(".em-placehold"); this.shown = false; this.blur = false; this.searching = null; this.loading = false; this.cookieCode = []; this.fixIe = false; this.HotSearch = []; this.HotSearch_content = {}; this.fundCp_content = {}; this.keyword = {}; this.fund_content = {}; this.FM = []; this.FM_content = {}; this.FC = []; this.FC_content = {}; this.random = Math.random(); this.ios = initEvent.isPhone() === "ios" ? "_self" : "_blank"; if (options.url) { initEvent.api = options.url } this.init(options) }; SearchBox.DEFAULTS = { url: "", hoverClass: "seaHover", count: 10, delay: 200, cookieName: "searchbar_code", affix: "?spm=search", gotoPage: "http://fund.eastmoney.com/data/fundsearch.html", gotoForm: "//fund.eastmoney.com/data/SearchDirect.aspx", onSelectFund: null, onlyFund: false }; SearchBox.prototype = { constructor: SearchBox, tooltipStr: function (bol) { var type = !!this.$select.length ? this.$select.find("[data-select-to].active").data("select-to") : "fund", html = null, show = this.shown && !bol ? type : false, that = this; if (!this.shown) { if (bol && (type === "fund-manager" || type === "fund-corp")) { html = initEvent.tooltip(type) } else { html = initEvent.tooltip("fund") } this.$tooltipTarget.data("type", type).empty().append(html); this.$tooltipTarget.find(".tooltip-nav li a").click(function (e) { e.preventDefault(); var alphabet = $(this).parent().data("alphabet"), val = that.$input.val(), $past = $(this).parent().parent().find("li.active"); $past.removeClass("active"); $(this).parent().addClass("active"); if (!alphabet) { that.initInput(val) } else { that.loadFundCpSearch(alphabet) } }) } else { this.liActive() } return this }, init: function (options) { var that = this, bol = !!this.$select.length, isIe8 = initEvent.Ie8_Ie6(), handle = $.proxy(that.handle, that); this.$input.click(function (e) { var val = $(this).val(); that.tooltipStr(bol).initInput(val).tooltipShow(); that.label(val) }); this.$input.focus(function () { var val = $(this).val(); that.label_new(val, true) }).blur(function () { var val = $(this).val(); that.label_new(val, false) }); this.$input.keydown(function (event) { var key = initEvent.keyCode, bol2 = that._isIn2(event.keyCode, key), val = $(this).val(); that.label(val); if (isIe8) { that.$input.off("input") } else { that.$input[0].onpropertychange = null } switch (event.keyCode) { case key.LEFT: that.dirEvent("prev"); break; case key.RIGHT: that.dirEvent("next"); break; case key.ENTER: break; case key.ESCAPE: that.tooltipHide(); break; case key.UP: that.up_down("up"); break; case key.DOWN: that.up_down("down"); break; default: if (bol2) { that.tooltipStr(bol).tooltipShow(); that._searchTimeout(event, $.proxy(function () { var val = $(this).val(); if (that._repeatKey(val)) { that.initInput(val) } $(this).trigger("KEYUP") }, this)) } break } }).on("KEYUP", function (event) { var val = $(this).val(), key = initEvent.keyCode, bol2 = that._isIn2(event.keyCode, key); if (isIe8) { that.$input.on("input", handle) } else { if (this.fixIe) { that.$input[0].onpropertychange = function () { var val = $(this).val(); that.initInput(val); this.fixIe = false } } } }).trigger("KEYUP"); if (bol) { this.$select.searchbar_select(); this.$select.on("trigger.select.lily", function (e) { var select = (e.relatedTarget).data("select-to"); that.changeSelect(select) }) } this.$submit.on("click", function (e) { var bol = that.enterEvent(); if (!!that.options.searchbox) { return false } if (!bol) { return false } }); this.cookieToArr(that.options.cookieName); this.$target.wrapInner('<form action="' + this.options.gotoForm + '"  data-searchbox="emForm"  method="get" target="' + this.ios + '"></form>'); this.$target.find('[data-searchbox="emForm"]').append('<input type="text" name="url" data-searchbox="seaFake" style="display:none;">') }, _repeatKey: function (key) { var type = this.$tooltipTarget.data("type"), content = type === "fund" ? "keyword" : type === "fund-manager" ? "FM" : type === "fund-corp" ? "FC" : "", bol = $.isArray(this[content][key]); if (bol) { return true } if (this.repeatKey && this.repeatKey === key) { return false } this.repeatKey = key; return true }, handle: function () { var val = this.$input.val(); if (this._repeatKey(val)) { this.initInput(val) } }, liActive: function () { var $act = this.$tooltipTarget.find(".tooltip-nav li.active"); $act.removeClass("active"); this.$tooltipTarget.find(".tooltip-nav li:eq(0)").addClass("active"); return this }, enterEvent: function () { var type = this.$tooltipTarget.data("type"), content, key, val = this.$input.val(), act = this.getActiveEle(this.$tooltipTarget.find("[data-submenu]." + this.options.hoverClass)), alphabet = this.$tooltipTarget.find(".tooltip-nav li.active").data("alphabet"); if (this.options.onSelectFund) { if (act >= 0) { var $act = this.$tooltipTarget.find("[data-submenu]." + this.options.hoverClass), submenu = $act.data("submenu"), cookie = $act.data("cookie"); if (submenu && cookie) { $act.trigger("click") } } return false } if (!val && act < 0) { this.gotoSearchPage(val, type === "fund-manager" ? "jjjl" : type === "fund-corp" ? "jjgs" : ""); return true } if (act >= 0) { var $act = this.$tooltipTarget.find("[data-submenu]." + this.options.hoverClass), submenu = $act.data("submenu"); if (!submenu || submenu === "jjgs") { this.gotoSearchPage(val, type === "fund-manager" ? "jjjl" : type === "fund-corp" ? "jjgs" : ""); return true } else { $act.trigger("click"); return false } } else { this.gotoSearchPage(val, type === "fund-manager" ? "jjjl" : type === "fund-corp" ? "jjgs" : ""); return true } }, up_down: function (dir) { var type = this.$tooltipTarget.data("type"), key, content, val = this.$input.val(), callback, $li = this.$tooltipTarget.find(".tooltip-nav li.active"), alphabet = $li.data("alphabet"); if (type === "fund") { if (!!val) { key = this.keyword[val]; content = this.fund_content } else { key = this.cookieCode; content = this.fund_content } if (!alphabet) { callback = "activateSubmenu_fund" } else { key = this.fundCp_content[alphabet]; callback = "activateSubmenu_fundCP" } } else { if (type === "fund-manager") { key = this.FM[val]; content = this.FM_content; callback = "activateSubmenu_FM" } else { if (type === "fund-corp") { key = this.FC[val]; content = this.FC_content; callback = "activateSubmenu_FC" } } } if (!!key && (!!key.length || !$.isEmptyObject(key))) { var $tr = this.$tooltipTarget.find("[data-submenu]"), index = this.getActiveEle($tr), next = dir == "down" ? "next" : "prev", fallback = dir == "down" ? "first" : "last", $next; if (index < 0) { $next = $tr.eq(0) } else { $next = $tr.eq(index)[next](); if (!$next.length) { $next = $tr[fallback]() } } this[callback]($next[0]) } }, _windowOpen: function (url) { window.open(url, this.ios) }, _urlMaker: function (val, affix) { if (!affix) { affix = "" } return this.options.gotoPage + "?spm=search&key=" + val + affix }, gotoSearchPage: function (val, bol) { var affix = ""; var that = this; if (bol && bol.length) { affix = ";" + bol } val = that.$input.val(); if (!!that.options.searchbox) { that.$tooltipTarget.SearchPage("#key" + encodeURIComponent(val) + affix) } else { var url = that._urlMaker(encodeURIComponent(val), affix); that.$target.find('[data-searchbox="seaFake"]').val(url) } that.tooltipHide() }, dirEvent: function (dir) { var type = this.$tooltipTarget.data("type"), $li = this.$tooltipTarget.find(".tooltip-nav li.active"), $next = $li[dir](), fallback = dir == "next" ? "first" : "last"; if (type === "fund-manager") { return } if (this.loading) { return } if (!$next.length) { $next = this.$tooltipTarget.find(".tooltip-nav li")[fallback]() } $li.removeClass("active"); $next.addClass("active"); var alphabet = $next.data("alphabet"), val = this.$input.val(); if (!alphabet) { this.initInput(val) } else { this.loadFundCpSearch(alphabet) } }, _searchTimeout: function (event, fCallback) { var that = this; clearTimeout(this.searching); this.searching = setTimeout(function () { if (fCallback) { fCallback() } }, this.options.delay) }, getCookie: function (name) { return $.cookie(name) }, cookieToArr: function (name) { var cookies = this.getCookie(name); if (!!cookies) { this.cookieCode = cookies.split("_") } else { this.cookieCode = [] } }, setCookie: function (name, val, expires, path) { $.cookie(name, val, { expires: expires, path: path }) }, cookiePlus: function (code) { if (!code || !/^[0-9a-z]+$/i.test(code)) { return } code = code + ""; var bol = this.checkRepeat(code, this.cookieCode); if (bol >= 0) { this.cookieCode.splice(bol, 1) } this.cookieCode.push(code); var len = this.cookieCode.length, num = len - this.options.count; if (num > 0) { this.cookieCode.splice(0, num) } this.setCookie(this.options.cookieName, this.cookieCode.join("_"), 365, "/") }, openWindow: function (href, code, cookies) { if (!code || !href) { return } if (cookies) { this.cookiePlus(cookies) } if (!!href && href.indexOf("//quote.eastmoney.com/unify/r/") > -1) { this._windowOpen(href + "." + code + this.options.affix) } else { this._windowOpen(href + code + ".html" + this.options.affix) } }, checkRepeat: function (code, arr) { return $.inArray(code, arr) }, loopObj: function ($obj, $target) { return $.contains($target[0], $obj[0]) }, initInput: function (val) { this.cookieToArr(this.options.cookieName); var len = val.length, type = this.$tooltipTarget.data("type"), cookies = this.cookieCode, len_cookie = cookies.length; this.label(val); if (type === "fund") { this.$tooltipTarget.find(".leftpanel").removeClass("seaWidthS seaWidthXL").addClass("seaWidthL loading").empty(); this.$tooltipTarget.find(".rightpanel").removeClass("seaWidthL seaHide").addClass("seaWidthS loading").empty() } if (!!len) { this.$tooltipTarget.find(".tooltip-nav li:eq(0) b").html("当前搜索"); if (type === "fund") { this.val_now = val; this.loadKeyword(val, this.loadHotSearch) } else { if (type === "fund-manager") { this.loadFM(val) } else { if (type === "fund-corp") { this.loadFC(val) } } } } else { this.$tooltipTarget.find(".tooltip-nav li:eq(0) b").html("最近搜索"); if (!len_cookie || type === "fund-manager" || type === "fund-corp") { var content = initEvent.select[type].inputContent; this.$tooltipTarget.find('[data-searchBox="panel"]').removeClass("loading").html('<p class="noKeyword">' + content + "</p>"); if (type === "fund") { this.loadHotSearch() } } else { if (type === "fund") { this.loadRecentSearch(this.loadHotSearch) } } } return this }, deal_data: function (data, name) { var obj = {}, arr = []; if (data && !!data.length) { for (var j = 0; j < data.length; j++) { obj[data[j][name]] = {}; arr.push(data[j][name]); $.each(data[j], function (i, n) { obj[data[j][name]][i] = n }) } } return { "obj": obj, "arr": arr } }, createHotSearch: function () { var content = this.HotSearch_content, k = this.HotSearch, $hotFund = $('<div class="hotFund">'), html = "<h5>热搜基金</h5><ul>", that = this; $.each(k, function (i, n) { var c = content[n]; html += "<li>"; html += '<a href="http://fund.eastmoney.com/' + n + ".html" + that.options.affix + '" target="_blank" data-cookie="' + n + '" title="' + c.FundName + '">' + (c.FundName).slice(0, 12) + "</a>"; html += "</li>" }); $hotFund.html(html + "</ul>"); this.$tooltipTarget.find(".rightpanel").removeClass("loading").addClass("seaGray").empty().append($hotFund); $hotFund.on("click", "[data-cookie]", function (e) { var cookie = $(this).data("cookie"); if (typeof that.options.onSelectFund === "function") { e.stopPropagation(); e.preventDefault(); var rowData = content[cookie]; rowData = { NAME: rowData.FundName, CODE: rowData.FundCode }; that.options.onSelectFund(rowData); that.tooltipHide() } else { that.cookiePlus(cookie) } }) }, createRecentSearch: function () { var content = this.fund_content, cookies = this.cookieCode, bol = this._isIn3(cookies, content), len = cookies.length, html = '<table border="0" cellspacing="0">', that = this; if (!bol) { this.$tooltipTarget.find('[data-searchBox="panel"]').removeClass("loading").html('<p class="noKeyword">' + initEvent.select.fund.inputContent + "</p>"); return } html += '<thead><tr><th class="seaCol1">代码</th><th class="seaCol2">名称</th>' + '<th class="seaCol3">简拼</th><th class="seaCol5">类型</th><th>&nbsp;</th></tr></thead>'; $.each(cookies, function (i, n) { n = cookies[len - i - 1]; if (!content[n]) { return } var obj = content[n], affix = obj.CATEGORYDESC === "债券" ? obj.STOCKMARKET : ""; if (!that.options.onlyFund || (that.options.onlyFund && $.inArray(obj.CATEGORY, [700, 750, 780]) >= 0)) { html += '<tr class="cookie-blue" data-submenu="' + obj.CODE + '" data-cookie="' + n + '" data-href="' + initEvent.hrefName[obj.CATEGORYDESC + affix] + '">'; html += '<td class="seaCol1">' + obj.CODE + "</td>"; html += '<td class="seaCol2" title="' + obj.NAME + '">' + (obj.NAME).slice(0, 12) + "</td>"; html += '<td class="seaCol3" title="' + obj.JP + '">' + ((obj.JP).toUpperCase()).slice(0, 12) + "</td>"; html += '<td class="seaCol4">' + obj.CATEGORYDESC + "</td>"; if (!obj.FundBaseInfo && !obj.StockHolder) { html += '<td class="seaCol5">&nbsp;</td>' } else { html += '<td class="seaCol5"><i class="seaArr"></i></td>' } html += "</tr>" } }); this.$tooltipTarget.find(".leftpanel").removeClass("loading").html(html + "</table>"); this.$tooltipTarget.find(".leftpanel [data-submenu]").click(function () { var cookie = $(this).data("cookie"), code = $(this).data("submenu"), href = $(this).data("href"); if (typeof that.options.onSelectFund === "function") { var rowData = content[cookie]; that.options.onSelectFund(rowData); that.tooltipHide() } else { that.openWindow(href, code, cookie) } }); that.$target.delayCursor("[data-submenu]", that) }, createKeywordSearch: function (val) { if (this.val_now !== val && !!this.keyword[this.val_now]) { val = this.val_now } var content = this.fund_content, k = this.keyword[val], cookies = this.cookieCode, newArr = this._extendArr(k, cookies), len = k.length, html = '<table border="0" cellspacing="0">', that = this; if (!k.length) { html += "<tbody>"; html += '<tr data-submenu="" class="noPadding"><td colspan="5" class="seacolfff"><p class="seacom"><a href="' + this._urlMaker(encodeURIComponent(val)) + '" target="_blank">很抱歉，没有找到与“<span class="r">' + val + "</span>”相关的内容</a></p></td></tr>" } else { html += '<thead><tr><th class="seaCol1">代码</th><th class="seaCol2">名称</th>' + '<th class="seaCol3">简拼</th><th class="seaCol5">类型</th><th>&nbsp</th></tr></thead><tbody>' } $.each(newArr.arr, function (i, n) { if (!content[n]) { return } var obj = content[n], affix = obj.CATEGORYDESC === "债券" ? obj.STOCKMARKET : ""; if (i <= (newArr.n - 1)) { html += '<tr class="cookie-blue" data-submenu="' + obj.CODE + '" data-cookie="' + n + '" data-href="' + initEvent.hrefName[obj.CATEGORYDESC + affix] + obj.NEWTEXCH + '">' } else { html += '<tr data-submenu="' + obj.CODE + '" data-cookie="' + n + '" data-href="' + initEvent.hrefName[obj.CATEGORYDESC + affix] + obj.NEWTEXCH + '">' } html += '<td class="seaCol1">' + that._addRed(obj.CODE, val) + "</td>"; html += '<td class="seaCol2" title="' + obj.NAME + '">' + that._addRed((obj.NAME).slice(0, 12), val) + "</td>"; html += '<td class="seaCol3" title="' + obj.JP + '">' + that._addRed(((obj.JP).toUpperCase()).slice(0, 12), val) + "</td>"; html += '<td class="seaCol4">' + obj.CATEGORYDESC + "</td>"; if (!obj.FundBaseInfo && !obj.StockHolder) { html += '<td class="seaCol5">&nbsp;</td>' } else { html += '<td class="seaCol5"><i class="seaArr"></i></td>' } html += "</tr>" }); html += '<tr class="cookie-blue noPadding" data-submenu="jjgs" data-href=""><td colspan="5" class="seacolall"><p class="seacom"><a href="' + this._urlMaker(encodeURIComponent(val), ";jjgs") + '" target="_blank">在 <b>基金公司</b> 分类下搜索 <span class="r">' + that.transfer(val) + " </span></a></p></td></tr>"; html += '<tr class="cookie-blue noPadding" data-submenu="jjgs" data-href=""><td colspan="5" class="seacolall"><p class="seacom"><a href="' + this._urlMaker(encodeURIComponent(val), ";jjjl") + '" target="_blank">在 <b>基金经理</b> 分类下搜索 <span class="r">' + that.transfer(val) + " </span></a></p></td></tr>"; html += '<tr class="cookie-blue noPadding" data-submenu="jjgs" data-href=""><td colspan="5" class="seacolall"><p class="seacom"><a href="' + this._urlMaker(encodeURIComponent(val), ";ztjj") + '" target="_blank">在 <b>基金主题</b> 分类下搜索 <span class="r">' + that.transfer(val) + " </span> </a></p></td></tr>"; var html2 = '<p class="seaCheck"><a href="' + this._urlMaker(encodeURIComponent(val), "") + '" target="_blank" class="checkmore">查看更多搜索结果</a><span class="blank">|</span>'; html2 += '<a href="javascript:void(0)" target="_self" class="checknow">查看最近搜索</a></p>'; this.$tooltipTarget.find(".leftpanel").removeClass("loading").html(html + "</tbody></table>" + html2); this.$tooltipTarget.find(".leftpanel [data-submenu]").click(function (e) { var cookie = $(this).data("cookie"), code = $(this).data("submenu"), href = $(this).data("href"); if (!cookie && !href) { if (!!that.options.searchbox) { that.gotoSearchPage(val, "jjgs"); return false } } if (typeof that.options.onSelectFund === "function") { var rowData = content[cookie]; that.options.onSelectFund(rowData); that.tooltipHide() } else { that.openWindow(href, code, cookie) } if (!!cookie && !!href) { that.loadval_key(cookie, val, code) } }); this.$tooltipTarget.find(".leftpanel [data-submenu] a").click(function (e) { e.stopPropagation() }); this.$tooltipTarget.find(".leftpanel .checknow").click(function (e) { e.preventDefault(); e.stopPropagation(); that.$input.val("").trigger("click").focus() }); this.activateSubmenu_fund(this.$tooltipTarget.find(".leftpanel [data-submenu]:eq(0)")[0]); this.menuEvent_fund($("tbody")); this.$tooltipTarget.find(".leftpanel .checkmore").click(function (e) { e.stopPropagation(); if (!!that.options.searchbox) { that.gotoSearchPage(val); return false } }) }, createFundCpSearch: function (val) { var content = this.fundCp_content[val], that = this; var html = '<table border="0" cellspacing="0">'; html += '<thead><tr><th class="seaCol6">基金公司</th><th>&nbsp</th></tr></thead>'; $.each(content, function (i, n) { html += '<tr data-submenu="' + i + '" data-al="' + val + '">'; html += '<td class="seaCol6">' + n.JJGS + "</td>"; html += '<td class="seaCol5"><i class="seaArr"></i></td>'; html += "</tr>" }); this.$tooltipTarget.find(".leftpanel").removeClass("loading seaHide").html(html + "</table>"); this.$tooltipTarget.find(".rightpanel").removeClass("loading seaWidthXL"); this.$tooltipTarget.find(".leftpanel [data-submenu]").click(function () { var code = $(this).data("submenu"); that._windowOpen("http://fund.eastmoney.com/company/" + code + ".html" + that.options.affix) }); this.activateSubmenu_fundCP(this.$tooltipTarget.find(".leftpanel [data-submenu]:eq(0)")[0]); this.menuEvent_fundCP($("tbody")) }, substr: function (str, len) { var str_length = 0; var str_len = 0; var str_cut = new String(); str_len = str.length; for (var i = 0; i < str_len; i++) { var a = str.charAt(i); str_length++; if (escape(a).length > 4) { str_length++ } str_cut = str_cut.concat(a); if (str_length >= len) { return str_cut } } if (str_length < len) { return str } }, createleftPanel_fund: function ($row) { var content = this.fund_content, code = $row.data("cookie"), that = this, val = this.$input.val(); if (!!content[code] && !!content[code].FundBaseInfo) { var html = '<div class="seaInfo">', detail = content[code].FundBaseInfo, text = detail.FTYPE === "货币型" || detail.FTYPE === "理财型" ? "万份收益" : "基金净值", content2 = "data-code=" + detail.FCODE; var html2 = detail.NAVURL ? 'href="' + detail.NAVURL + that.options.affix + '" target="_blank"' : 'href="javascript:void(0)" target="_self" class="gray"'; html += "<h4>" + detail.SHORTNAME + "</h4>"; if (detail.ISBUY == 1 || detail.ISBUY == 2 || detail.ISBUY == 3 || detail.ISBUY == 8 || detail.ISBUY == 9) { var html4 = 'href="http://fundact.eastmoney.com/fundinfo/' + detail.FCODE + ".html" + that.options.affix + '" target="_blank"'; html += '<p class="gray">' + detail.MINSG + "元起  | <a " + html4 + " >购买</a></p>" } else { if (!!detail.ISBUY.length) { var html4 = 'href="javascript:void(0)" target="_self" class="gray"'; html += '<p class="gray">' + detail.MINSG + "元起  | <a " + html4 + " >" + initEvent.isBuy[detail.ISBUY] + "</a></p>" } } html += '<ul class="clearfix">'; html += '<li class="infopadding widthAll"><a href="http://fund.eastmoney.com/' + detail.FCODE + ".html" + that.options.affix + '" target="_blank" ' + content2 + ">" + text + "：<b>" + this._isNull(detail.DWJZ) + " </b><span>" + this._formatDate(detail.FSRQ) + "</span></a></li>"; html += '<li class="infopadding"><a href="http://fund.eastmoney.com/company/' + detail.JJGSID + ".html" + that.options.affix + '" target="_blank" >' + detail.JJGS + "</a></li>"; html += '<li class="infoWidth62"><a ' + html2 + ">" + detail.FTYPE + "</a></li>"; html += '<li class="infoWidth62"><a href="http://jijinba.eastmoney.com/list,' + detail.FCODE + ".html" + that.options.affix + '" target="_blank" ' + content2 + ' class="hover">基金吧</a></li>'; html += '<li class="infoWidth62"><a href="http://fundf10.eastmoney.com/jjjl_' + detail.FCODE + ".html" + that.options.affix + '" target="_blank" ' + content2 + ">基金经理</a></li>"; var ztjjArr = content[code].ZTJJInfo; var htmlZtjj = ""; if (ztjjArr && ztjjArr.length > 0) { htmlZtjj += "<h5>所属基金主题</h5>"; htmlZtjj += '<ul class="clearfix">'; $(ztjjArr).each(function (index, item) { if (item.TTYPENAME && item.TTYPE) { htmlZtjj += '<li class="infoWidth62"><a href="http://fund.eastmoney.com/ztjj2/#!syl/Y/curr/' + item.TTYPE + "-" + encodeURIComponent(item.TTYPENAME) + '" target="_blank" ' + content2 + ">" + that.substr(item.TTYPENAME, 8) + "</a></li>" } }); htmlZtjj += "</ul>" } var oldName = detail.OTHERNAME ? (detail.OTHERNAME).split(",") : false; if (!oldName) { var html3 = "" } else { var html3 = "<h5>常用别名/历史曾用名</h5>"; for (var i = 0; i < oldName.length; i++) { html3 += "<p>" + oldName[i] + "</p>" } } this.$tooltipTarget.find(".rightpanel").html(html + "</ul>" + htmlZtjj + html3 + "</div>").removeClass("seaHide loading"); this.$tooltipTarget.find(".leftpanel").removeClass("seaWidthXL"); this.$tooltipTarget.find(".rightpanel a[data-code]").click(function () { var code = $(this).data("code"); that.cookiePlus(code); if (!!val) { that.loadval_key(code, val, code) } }); this.$tooltipTarget.find(".rightpanel .seaInfo a").hover(function () { $(this).parent().parent().find("a.hover").removeClass("hover"); $(this).addClass("hover") }, function () { $(this).removeClass("hover") }) } else { if (!!content[code] && !!content[code].StockHolder) { var html = '<div class="seaInfo">', detail = content[code].StockHolder; html += "<h4>" + content[code].NAME + "</h4>"; html += "<h5>持仓基金</h5>"; for (var i = 0; i < detail.length; i++) { html += '<p><a href="http://fund.eastmoney.com/' + detail[i].Code + ".html" + that.options.affix + '" target="_blank">' + detail[i].Name + "</a></p>" } html += '<p class="blue"><a href="http://data.eastmoney.com/zlsj/detail/' + content[code].CODE + ".html" + that.options.affix + '" target="_blank">查看更多持仓基金>></a></p>'; this.$tooltipTarget.find(".rightpanel").html(html + "</div>").removeClass("seaHide loading"); this.$tooltipTarget.find(".leftpanel").removeClass("seaWidthXL") } else { this.$tooltipTarget.find(".leftpanel").addClass("seaWidthXL"); this.$tooltipTarget.find(".rightpanel").addClass("seaHide") } } }, createleftPanel_fundCP: function ($row) { var content = this.fundCp_content, code = $row.data("submenu"), alphabet = $row.attr("data-al"), detail = content[alphabet][code].QXJJ; var html = '<div class="CP_content"><h5>' + content[alphabet][code].JJGS + "旗下基金</h5><ul>", that = this; if (!!detail.length) { $.each(detail, function (i, n) { html += "<li>"; html += '<a href="http://fund.eastmoney.com/' + n.FCODE + ".html" + that.options.affix + '" target="_blank" data-cookie="' + n._id + '" title="' + n.SHORTNAME + '">' + (n.SHORTNAME).slice(0, 9) + "</a>"; html += "</li>" }) } else { html += "<p>该公司旗下暂无基金产品。</p>" } this.$tooltipTarget.find(".rightpanel").html(html + "</ul></div>").removeClass("seaHide"); this.$tooltipTarget.find(".rightpanel").off("click", "[data-cookie]").on("click", "[data-cookie]", function (e) { var cookie = $(this).data("cookie"); if (typeof that.options.onSelectFund === "function") { e.stopPropagation(); e.preventDefault(); var detail_obj = that.deal_data(detail, "_id").obj; var detail_item = detail_obj[cookie]; var rowData = { NAME: detail_item.SHORTNAME, CODE: detail_item.FCODE }; that.options.onSelectFund(rowData); that.tooltipHide() } else { that.cookiePlus(cookie) } }) }, createFMSearch: function (val) { var content = this.FM_content, k = this.FM[val], html = '<div class="search-FM"><table border="0" cellspacing="0">', that = this; if (!k.length) { html += "<tbody>"; html += '<tr data-submenu="" class="noPadding"><td colspan="2" class="seacolfff">很抱歉，没有找到与“<span class="r">' + val + "</span>”相关的基金经理</td></tr>" } else { html += "<thead><tr><th>姓名</th><th>简拼</th></tr></thead><tbody>" } $.each(k, function (i, n) { var obj = content[n]; html += '<tr data-submenu="' + n + '" data-href="' + initEvent.hrefName.FM + '">'; html += '<td class="seaCol1">' + that._addRed(obj.MgrName, val) + "</td>"; html += '<td class="seaCol2">' + that._addRed((obj.AbbName).toUpperCase(), val) + "</td>"; html += "</tr>" }); this.$tooltipTarget.find(".allpanel").removeClass("loading").html(html + "</tbody></table></div>"); this.$tooltipTarget.find(".allpanel [data-submenu]").click(function () { var code = $(this).data("submenu"), href = $(this).data("href"); if (!code && !href) { that.gotoSearchPage(val, "jjjl") } else { that._windowOpen(href + code + ".html" + that.options.affix) } }).hover(function () { that.activateSubmenu_FM($(this)) }, function () { }) }, activateSubmenu_FM: function (that) { var $act = $(that).parent().find("tr." + this.options.hoverClass); $act.removeClass(this.options.hoverClass); $(that).addClass(this.options.hoverClass) }, createFCSearch: function (val) { var content = this.FC_content, k = this.FC[val], html = '<div class="search-FC"><table border="0" cellspacing="0">', that = this; if (!k.length) { html += "<tbody>"; html += '<tr data-submenu="" class="noPadding"><td colspan="2" class="seacolfff">很抱歉，没有找到与“<span class="r">' + val + "</span>”相关的基金公司</td></tr>" } else { html += "<thead><tr><th>基金公司</th><th>简拼</th></tr></thead><tbody>" } $.each(k, function (i, n) { var obj = content[n]; html += '<tr data-submenu="' + n + '" data-href="' + initEvent.hrefName.FC + '">'; html += '<td class="seaCol1">' + that._addRed(obj.JJGS, val) + "</td>"; html += '<td class="seaCol2">' + that._addRed((obj.JJGSJP).toUpperCase(), val) + "</td>"; html += "</tr>" }); this.$tooltipTarget.find(".allpanel").removeClass("loading").html(html + "</tbody></table></div>"); this.$tooltipTarget.find(".allpanel [data-submenu]").click(function () { var code = $(this).data("submenu"), href = $(this).data("href"); if (!code && !href) { that.gotoSearchPage(val, "jjgs") } else { that._windowOpen(href + code + ".html" + that.options.affix) } }).hover(function () { that.activateSubmenu_FC($(this)) }, function () { }) }, activateSubmenu_FC: function (that) { var $act = $(that).parent().find("tr." + this.options.hoverClass); $act.removeClass(this.options.hoverClass); $(that).addClass(this.options.hoverClass) }, loadHotSearch: function () { var url = initEvent.api, len = $.isEmptyObject(this.HotSearch_content), that = this; if (!len) { this.createHotSearch() } else { initEvent.JsLoader(url, "m=0", function (result) { that.HotSearch_content = that.deal_data(result.Datas, "FundCode").obj; that.HotSearch = that.deal_data(result.Datas, "FundCode").arr; that.createHotSearch() }) } }, loadFundCpSearch: function (val) { var len = this.fundCp_content[val], that = this, url = initEvent.api; this.$tooltipTarget.find(".leftpanel").removeClass("seaWidthL seaWidthXL").addClass("seaWidthS loading").empty(); this.$tooltipTarget.find(".rightpanel").removeClass("seaWidthS seaHide").addClass("seaWidthL loading").empty(); if (!!len) { this.createFundCpSearch(val) } else { this.loading = true; initEvent.JsLoader(url, "m=3&key=" + encodeURIComponent(val), function (result) { that.fundCp_content[val] = that.deal_data(result.Datas, "JJGSID").obj; that.createFundCpSearch(val); that.loading = false }) } }, loadRecentSearch: function (fCallback) { var cookies = this.cookieCode, len = $.isEmptyObject(this.fund_content), that = this, url = initEvent.api, isIn = this._isIn(this.cookieCode, this.fund_content); if (!len && isIn) { if (fCallback) { fCallback.call(that) } this.createRecentSearch() } else { this.loading = true; initEvent.JsLoader(url, "m=5&key=" + cookies.join(","), function (result) { that.fund_content = $.extend({}, that.fund_content, that.deal_data(result.Datas, "_id").obj); that.loading = false; if (fCallback) { fCallback.call(that) } that.createRecentSearch() }) } }, loadKeyword: function (val, fCallback) { var url = initEvent.api, len = this.keyword[val], that = this; if (!!len) { this.createKeywordSearch(val) } else { this.loading = true; var m = "m=1"; if (this.options.onlyFund) { m = "m=9" } initEvent.JsLoader(url, m + "&key=" + encodeURIComponent(val), function (result) { var data = that.deal_data(result.Datas, "_id"); that.fund_content = $.extend({}, that.fund_content, data.obj); that.keyword[val] = data.arr; that.loading = false; that.createKeywordSearch(val) }) } }, loadFM: function (val) { var url = initEvent.api, len = this.FM[val], that = this; if (!!len) { this.createFMSearch(val) } else { initEvent.JsLoader(url, "m=7&key=" + encodeURIComponent(val), function (result) { var data = that.deal_data(result.Datas, "MgrId"); that.FM_content = $.extend({}, that.FM_content, data.obj); that.FM[val] = data.arr; that.createFMSearch(val) }) } }, loadFC: function (val) { var url = initEvent.api, len = this.FC[val], that = this; if (!!len) { this.createFCSearch(val) } else { initEvent.JsLoader(url, "m=8&key=" + encodeURIComponent(val), function (result) { var data = that.deal_data(result.Datas, "JJGSID"); that.FC_content = $.extend({}, that.FC_content, data.obj); that.FC[val] = data.arr; that.createFCSearch(val) }) } }, loadval_key: function (id, val, code) { var url = initEvent.api; initEvent.JsLoader(url, "m=6&Key=" + encodeURIComponent(val) + "&_id=" + id + "&code=" + code, function (result) { }) }, transfer: function (val) { var code = { ">": "&gt;", "<": "&lt;" }; $.each(code, function (i, n) { val = val.replace(new RegExp(i, "g"), n) }); return val }, _addRed: function (str, val) { var shuzi = val.match(/[0-9]+/g) || [], zhongwen = val.match(/[\u4e00-\u9fa5]+/g) || [], yinwen = val.match(/[A-Z]+/ig) || [], arr = $.merge(shuzi, $.merge(yinwen, zhongwen)), result = [str]; $.each(arr, function (i, n) { var re = new RegExp("(" + (n.toUpperCase()) + ")", "i"); $.each(result, function (a, b) { var len = n.length, len2 = b.length, index = b.match(re); if (!index) { return true } result.splice(a, 1); index = b.match(re).index; result.splice(a, 0, b.slice(index + len, len2)); result.splice(a, 0, b.slice(index, index + len)); result.splice(a, 0, b.slice(0, index)); return false }) }); $.each(arr, function (i, n) { $.each(result, function (a, b) { if (n.toUpperCase() === b.toUpperCase()) { result.splice(a, 1, '<span class="r">' + b + "</span>"); return false } }) }); return result.join("") }, _extendArr: function (a, b) { var m = 0; $.each(b, function (i, n) { $.each(a, function (c, d) { if (d === n) { a.splice(c, 1); a.unshift(d); m++; return false } }) }); return { "arr": a, "n": m } }, _isNull: function (num) { if (!!num) { num = num.toFixed(4); return num } else { return "--" } }, _isIn: function (arr, obj) { var a = 0; $.each(arr, function (i, n) { if (!obj[n]) { a++ } }); if (!a) { return true } else { return false } }, _isIn3: function (arr, obj) { var a = 0, len = arr.length; $.each(arr, function (i, n) { if (!obj[n]) { a++ } }); if (!a) { return true } else { if (a !== len) { return true } else { return false } } }, _isIn2: function (k, obj) { var a = 0; $.each(obj, function (i, n) { if (k === n) { a++ } }); if (!a) { return true } else { return false } }, _formatDate: function (date) { if (!date) { return "" } var arr = date.split("-"); if (!!date) { return arr[1] + "-" + arr[2] } else { return "" } }, label: function (val) { return; var len = val.length, display = this.$label.is(":visible"); if (!!len) { if (display) { this.$label.hide() } } else { if (!display) { this.$label.show() } } }, label_new: function (val, bol) { var len = val.length, display = this.$label.is(":visible"); if (bol) { if (display) { this.$label.hide() } } else { if (!len && !display) { this.$label.show() } } }, tooltipShow: function () { var that = this; if (this.shown) { return } this.shown = true; this.$tooltipTarget.addClass("seaIn"); if (that.blur) { return } that.blur = true; $(document).on("click.searchBox.api." + this.random, function (e) { var blur = that.loopObj($(e.target), that.$target); if (!blur) { that.tooltipHide() } }); this.$tooltipTarget.find('[data-searchBox="dismiss"]').on("click", function (e) { e.preventDefault(); that.tooltipHide() }) }, tooltipHide: function () { if (!this.shown) { return } this.shown = false; this.$tooltipTarget.removeClass("seaIn"); this.blur = false; $(document).off("click.searchBox.api." + this.random); this.$tooltipTarget.find('[data-searchBox="dismiss"]').off("click") }, changeSelect: function (name) { var html = initEvent.select[name].inputContent; this.$label.html(html); this.tooltipHide() }, menuEvent_fund: function ($menu) { var that = this; $menu.menuAim({ activate: $.proxy(that.activateSubmenu_fund, that), deactivate: $.proxy(that.deactivateSubmenu, that) }); return this }, menuEvent_fundCP: function ($menu) { var that = this; $menu.menuAim({ activate: $.proxy(that.activateSubmenu_fundCP, that), deactivate: $.proxy(that.deactivateSubmenu, that) }) }, activateSubmenu_fund: function (row) { var $row = $(row), that = this; this.getActiveEle($row, true); this.createleftPanel_fund($row); $row.addClass(that.options.hoverClass) }, activateSubmenu_fundCP: function (row) { var $row = $(row), that = this; this.getActiveEle($row, true); this.createleftPanel_fundCP($row); $row.addClass(that.options.hoverClass) }, deactivateSubmenu: function (row) { var $row = $(row), that = this; $row.addClass(that.options.hoverClass) }, getActiveEle: function ($ele, bol) { var that = this, $eles = $ele.parent(), $act = $eles.find("." + that.options.hoverClass); if (bol && !!$act.length) { $act.removeClass(that.options.hoverClass) } else { return $eles.children().index($act) } } }; var old = $.fn.searchBox; $.fn.searchBox = function (option) { return this.each(function () { var $this = $(this), data = $this.data("searchBox"), options = $.extend({}, SearchBox.DEFAULTS, $this.data(), option); if (!data) { $this.data("searchBox", (data = new SearchBox(this, options))) } }) }; $.fn.searchBox.noConflict = function () { $.fn.searchBox = old; return this } })(j); (function ($) { document.execCommand("BackgroundImageCache", false, true); $(function () { $('[data-plugin="searchBox"]').searchBox(); if ($("#aships_new").length === 0) { return } var content = ($("#aships_new").html()).replace(/(\(|（)[^（\(\)）]*?(\)|）)/g, ""); $('[data-plugin="jjgs"]').on("click", function (e) { e.stopPropagation(); var $target = $($(this).data("target")), $close = $target.find('[data-jjgs="dismiss"]'), $content = $target.find('[data-jjgs="content"]'), shown = $target.is(":visible"), $this = $(this), opening = $target.is(":visible"); if (!$content.html()) { $content.html(content) } if (!opening) { $target.show(); $this.removeClass("seach-icon-down").addClass("seach-icon-up"); $(document).on("click.cp.api", function (e) { var target = e.target, bol = $.contains($target[0], target); if (!bol || target === $close[0]) { $target.hide(); $this.removeClass("seach-icon-up").addClass("seach-icon-down"); $(document).off("click.cp.api") } }) } else { $target.hide(); $this.removeClass("seach-icon-up").addClass("seach-icon-down"); $(document).off("click.cp.api") } }) }) })(j);